<div class="{{ name }}">
    <div class="pic_team">
        <div class="team_part">
            <div class="pic show_pics"></div>
            <div>
                <button class="choose_pic">+</button>
                <button class="play_show_video play">▷</button>

                <input type="file" class="pics hidden" name="pics" hidden>
            </div>
        </div>
        <div class="team_part">
            <div class="pic out_pic"></div>
            <div>
                <button class="play_out_video play">▷</button>
                <span class="out_msg">True</span>
            </div>
        </div>
    </div>
    <div class="" style="height: 100px;line-height: 100px;font-size: 28px;text-align: center">
        <button class="upload_btn">Upload Files</button>
    </div>
</div>

<script>
    $(".{{ name }} .choose_pic,.{{ name }} .show_pics").click(function () {
        $(".{{ name }} .pics").click();
    });
    $(".{{ name }} .play_show_video,.{{ name }} .play_out_video").click(function () {
        var video = $(this).parents(".team_part").find("video") //$(".show_pics").find("video");
        if (video.length > 0) {
            if ($(this).hasClass("play")) {
                video[0].play();
                $(this).removeClass("play").addClass("pause").text("||")
            } else {
                video[0].pause();
                $(this).removeClass("pause").addClass("play").text("▷");
            }
        }
        console.log("video: ",video.length);
    });
    $(".{{ name }} input[name='pics']").change(function () {
        $(".{{ name }} .show_pics video").remove();
        $(".{{ name }} .out_pic video").remove();
        $(".{{ name }} .out_msg").text("");
        var files = $(this).prop("files");
        for (var i = 0;i<files.length;i++){
            var reader = new FileReader();
            //reader.readAsBinaryString(files[i]);
            reader.readAsDataURL(files[i])
            reader.onload = function(e) {
                var img = e.currentTarget.result;
                $(".{{ name }} .show_pics").append("<video src="+img+"></video>");
                // $(".{{ name }} .show_pics").append("<img src="+img+"></img>");
            };
        }
    });
</script>
<script>
    $(function () {
        var csrftoken = $("meta[name=csrf-token]").attr("content");
        Notiflix.Notify.Init();
        Notiflix.Loading.Init();
        $('.{{ name }} .upload_btn').click(function(){
            $(".{{ name }} .out_pic").children().remove();

            var data = new FormData();
            var files = $('.{{ name }} .pics').prop('files');

            if (files.length == 0) {
                Notiflix.Notify.Failure("Please select one file ....");
                return;
            }

            data.append('file', files[0]);

            data.append("mode","{{ name }}");

            Notiflix.Loading.Standard();
            Notiflix.Notify.Success('Upload File .....,Waiting.....');

            $.ajax({
                type: 'POST',
                url: "{{ blue_url_for('upload') }}"+"?mode={{ name }}",
                data: data,
                cache: false,
                processData: false,
                contentType: false,
                headers:{"X-CSRFToken":csrftoken},
                success: function (ret) {
                    console.log("res: ", ret);
                    Notiflix.Loading.Remove();
                    if (ret.code == 200) {
                        Notiflix.Notify.Success(ret.msg);
                        // $(".out_pic").append("<img src='"+ ret.out_path +"'></img>");
                        $(".{{ name }} .out_pic").append("<video src="+ ret.out_path +"></video>");
                        $(".{{ name }} .out_msg").text(ret.res);
                    } else {
                        Notiflix.Notify.Failure(ret.msg)
                    }
                }
            });
        })
    });

</script>
